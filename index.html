<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strava Authentication</title>
</head>
<body>
    <h1>Strava Authentication</h1>
    <button onclick="authorizeStrava()">Authorize with Strava</button>
    <script>
        // Redirect to Strava's authorization page
        function authorizeStrava() {
            const clientId = '152606';
            const redirectUri = 'aicycle.pages.dev';
            const scope = 'activity:read_all';
            const responseType = 'code';
            const authUrl = `https://www.strava.com/oauth/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=${responseType}&scope=${scope}`;
            window.location.href = authUrl;
        }

        // Handle the callback and exchange authorization code for access token
        async function handleCallback() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            if (code) {
                const clientId = '152606';
                const clientSecret = '3e3b2b7bdaaa8af1fa47987536d6406c3061be76';
                const tokenUrl = 'https://www.strava.com/oauth/token';
                const response = await fetch(tokenUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        client_id: clientId,
                        client_secret: clientSecret,
                        code: code,
                        grant_type: 'authorization_code'
                    })
                });
                const data = await response.json();
                const accessToken = data.access_token;
                console.log('Access Token:', accessToken);
                // Use the access token to fetch workout data
            }
        }

        // Call handleCallback() on page load if the URL contains an authorization code
        window.onload = handleCallback;
    </script>
</body>
</html>
